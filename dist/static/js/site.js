var simpleformsApp=angular.module("simpleformsApp",["ui.router"]);simpleformsApp.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,r,o){r.otherwise("/"),e.state("dashboard",{url:"/",templateUrl:"../static/partials/dashboard.html",controller:"dashboardCtrl",data:{requireLogin:!0}}).state("create_form",{url:"/create_form",templateUrl:"../static/partials/create_form.html",controller:"createformCtrl",data:{requireLogin:!0}}).state("view_forms",{url:"/view_forms",templateUrl:"../static/partials/view_forms.html",controller:"viewformsCtrl",params:{formId:null},data:{requireLogin:!0}}).state("view_response",{url:"/view_response/:responseId",templateUrl:"../static/partials/view_response.html",data:{requireLogin:!0}}).state("create_response",{url:"/create_response/:formId",templateUrl:"../static/partials/create_response.html",controller:"createresponseCtrl",data:{requireLogin:!1}}).state("login",{url:"/login",templateUrl:"../static/partials/login.html",controller:"loginCtrl",data:{requireLogin:!1}}).state("register",{url:"/register",templateUrl:"../static/partials/register.html",controller:"registerCtrl",data:{requireLogin:!1}})}]),simpleformsApp.run(["$rootScope","$state","LoginService","$http",function(e,r,o,s){e.$on("$stateChangeStart",function(e,t,n){var i=t.data.requireLogin,a=o.sessionLogin;i&&o.loggedIn()===!1&&s({method:"GET",url:"/current_user"}).then(function(o){if("not logged in"===o.data)e.preventDefault(),r.go("login");else{var s={username:o.data.userData.username,id:o.data.userData.user_id};a(s)}},function(e){})})}]),simpleformsApp.service("LoginService",["$http","$state",function(e,r){var o=!1,s={};this.loggedIn=function(){return o},this.getUser=function(){return s},this.sessionLogin=function(e){s.username=e.username,s.id=e.id,o=!0},this.login=function(t){e({method:"POST",url:"/login",data:{username:t.username,password:t.password},headers:{"Content-Type":"application/json"}}).success(function(e){e.userData?(o=!0,s.username=e.userData.username,s.id=e.userData.user_id,r.go("dashboard")):(o=!1,alert("could not log in"))})},this.logout=function(){e({method:"POST",url:"/logout"}).success(function(e){console.log(e),o=!1,s={},r.go("login")})}}]),simpleformsApp.factory("RegisterService",["$http",function(e){var r={};return r.checkUsername=function(r){return e({method:"POST",url:"/check_username",data:{username:r},headers:{"Content-Type":"application/json"}})},r.registerUser=function(r,o){return e({method:"POST",url:"/register_user",data:{username:r,password:o},headers:{"Content-Type":"application/json"}})},r}]),simpleformsApp.factory("FormService",["$http",function(e){var r={};return r.recentForms=function(){return e.get("/recent_forms")},r.getForm=function(r){return e.get("/get_form/"+r)},r}]),simpleformsApp.factory("ResponseService",["$http",function(e){var r={};return r.recentResponses=function(){return e.get("/recent_responses")},r.submitResponse=function(r){return e.post("/submit_response",r)},r}]),simpleformsApp.controller("createformCtrl",["$scope","$http","$state","LoginService",function(e,r,o,s){e.user=s.getUser(),e.form={title:"Untitled Form",description:"",questions:[{title:"",type:"Text",options:[]}],user_id:e.user.id};var t=e.form.questions;e.questionTypes=["Text","Paragraph","Multiple Choice","Check Box","Dropdown"],e.changeQuestionType=function(r,o){t[r].type=e.questionTypes[o],"Text"===e.questionTypes[o]||"Paragraph"===e.questionTypes[o]?t[r].options=[]:t[r].options=[""]},e.addQuestion=function(){t.push({title:"",type:"Text",options:[]})},e.addQuestionAfter=function(e){t.splice(e+1,0,{title:"",type:"Text",options:[]})},e.removeQuestion=function(e){t.splice(e,1)},e.duplicateQuestion=function(e){var r=t[e],o={};o.title=r.title,o.type=r.type,o.options=r.options,t.splice(e+1,0,o)},e.addOption=function(e){t[e].options.push("")},e.minimumOptions=function(e){return 1==t[e].options.length},e.removeOption=function(e,r){t[e].options.splice(r,1)},e.submitForm=function(){r({method:"POST",url:"/submit_form",data:e.form,headers:{"Content-Type":"application/json"}}).success(function(e){o.go("view_forms")})}}]),simpleformsApp.controller("viewformsCtrl",["$scope","$http","$stateParams","LoginService",function(e,r,o,s){e.user=s.getUser(),e.active_form=0,r.get("/forms/"+e.user.id).then(function(r){if(e.forms=r.data.forms,null!==o.formId)for(var s=0;s<e.forms.length;s++)if(e.forms[s].id==o.formId){e.active_form=s;break}},function(e){console.log("error"+e)}),e.isActiveForm=function(r){return r===e.active_form},e.setActiveForm=function(r){e.active_form=r},e.deleteForm=function(o){confirm("Are you sure you want to delete this form? All responses will also be deleted.")&&r({method:"POST",url:"/delete_form/"+e.forms[o].id}).success(function(r){console.log(r),e.active_form=0,e.forms.splice(o,1)})}}]),simpleformsApp.controller("navCtrl",["$scope","LoginService",function(e,r){e.loggedIn=r.loggedIn,e.logout=r.logout}]),simpleformsApp.controller("loginCtrl",["$scope","LoginService",function(e,r){e.login=r.login}]),simpleformsApp.controller("registerCtrl",["$scope","LoginService","RegisterService",function(e,r,o){e.login=r.login,e.passwordMismatch=!1,e.usernameTaken=!1,e.register=function(){e.password===e.passwordConfirm?(e.passwordMismatch=!1,o.checkUsername(e.username).success(function(r){"unused"===r?(e.usernameTaken=!1,o.registerUser(e.username,e.password).success(function(r){"success"===r?e.login(user={username:e.username,password:e.password}):console.log(r)}).error(function(e){console.log(e)})):"used"===r?e.usernameTaken=!0:console.log(r)}).error(function(e){console.log(e)})):e.passwordMismatch=!0}}]),simpleformsApp.controller("dashboardCtrl",["$scope","LoginService","FormService","ResponseService",function(e,r,o,s){e.user=r.getUser(),o.recentForms().success(function(r){e.recentForms=r.forms}).error(function(e){console.log("error"+e)}),s.recentResponses().success(function(r){e.recentResponses=r.responses}).error(function(e){console.log("error"+e)})}]),simpleformsApp.controller("createresponseCtrl",["$scope","$stateParams","$state","ResponseService","FormService",function(e,r,o,s,t){var n=function(r){e.response={},e.response.formId=r.id;var o=r.questions;e.response.question_answers=[];for(var s=0;s<o.length;s++)if(e.response.question_answers[s]={},e.response.question_answers[s].questionId=o[s].id,"Check Box"===o[s].type){e.response.question_answers[s].answers=[];for(var t=0;t<o[s].options.length;t++)e.response.question_answers[s].answers.push("")}else e.response.question_answers[s].answers=[""]};t.getForm(r.formId).success(function(r){e.form=r.form,n(e.form)}).error(function(e){console.log("error")}),e.checkboxChange=function(r,o){""===e.response.question_answers[r].answers[o]?e.response.question_answers[r].answers[o]=e.form.questions[r].options[o].text:e.response.question_answers[r].answers[o]=""},e.submitResponse=function(){s.submitResponse(e.response).success(function(e){o.go("dashboard")}).error(function(e){console.log(e)})}}]),simpleformsApp.controller("viewresponseCtrl",["$scope","$http","$stateParams",function(e,r,o){r.get("/response/"+o.responseId).then(function(r){e.response=r.data},function(e){console.log("error"+e)})}]),simpleformsApp.directive("sfTest",function(){return{template:"<h3>Hello World!!{{letter}}</h3>"}}),simpleformsApp.directive("sfQuestion",function(){return{templateUrl:"../static/partials/create_form_question.html"}}),simpleformsApp.directive("sfNav",function(){return{restrict:"E",templateUrl:"../static/partials/nav.html",controller:"navCtrl"}});